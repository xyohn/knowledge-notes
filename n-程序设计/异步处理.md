# 异步处理

1. 是什么
   * 执行一项操作时，不去等待操作结束，而是给这个操作一个命令：“当操作完成后，接下来去执行什么
   * 主业务不再主动关心从业务执行情况，而是等待从业务的通知
   * 一种提升CPU利用率的方式，使CPU一直处于工作而非等待的状态

2. 为什么

   1. 可减少或者避免这种无意义的等待，提升系统性能

      > 同步实现下，线程大部分时间都没有在工作，而是在等待

   2. 不能加快程序本身的速度，但可以减少或者避免线程等待，用很少的线程达到较高的吞吐能力

      > 不能加快速度指的是所有任务累加的时间，但任务之间是可能存在并行的情况

3. 缺点

   * 相比同步实现，代码复杂度要高，可读性和可维护性较低
   * 不适合复杂的业务场景

4. 实现

   1. CompletableFuture

      > 通过 `thenRun()` 等方法实现任务串联及回调

   2. RxJava

## 思考

1. 异步的误区

   在开发中经常见到很多同事对异步存在误区，认为只要异步了效率就一定大于同步；异步就是性能优化的无脑选择..等等等等，所以在代码里经常能看到各处的异步处理，非但没提升处理效率，还造成了各种奇葩的问题

   我个人对异步的理解是，某一业务的处理与请求的线程(主线程)非同一线程都可以叫异步处理。但是在这种场景下，并非一定能提升性能，例如主线程需要等待该业务处理线程返回结果后才能继续后续操作，这个时候发挥了异步，但没发挥异步带来的价值。

   所以我觉得异步的合适使用场景应该是，异步线程的结果不影响主线程的处置的场景，或是多个独立任务执行后合并的场景。思路是让操作不等待或者少等待。

   而对于有因果关系等场景的业务块，就还是少考虑异步，即便可以实现回调，让异步线程通知主线程结果，但它并不能阻止已经发生的事情。就好像我们作为收银员在给客户结账的时候，客户提供的现金我们如果异步验真伪（例如说交给同事验真伪），我们继续进行结账流程，那即便同事过后跑过来跟你说（回调）钱是假的，不能收。这时候可能结账流程已经结束，客户已经走了呢？

   

## 参考资料

* 极客时间-消息队列高手课