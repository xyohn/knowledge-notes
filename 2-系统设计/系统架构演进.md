# 系统架构演进

1. 演进的核心——成本的控制

   不仅代表购买服务器的费用，还包括研发团队，内部的开发成本，沟通成本以及运维成本等等，甚至有些时候，成本会成为架构设计中的决定性因素

2. 系统架构

3. 演进的架构

   1. 单体时代

      1. 优势

         1. 开发简单直接，代码和项目集中式管理；
         2. 只需要维护一个工程，节省维护系统运行的人力成本；
         3. 排查问题的时候，只需要排查这个应用进程就可以了，目标性强。

      2. 问题

         1. 容易产生瓶颈（如数据库）

         2. 增加了研发的成本，抑制了研发效率的提升

         3. 系统运维成本变大

            如发版的影响等等

   2. SOA时代

   3. 微服务时代

      > 微服务化只是一种架构手段，有效拆分后，可以帮助实现服务的敏捷开发和部署

      1. 拆分原则

         1. 单一服务内部功能高内聚，低耦合

            > 说起来简单但是做起来难的事情，关注点需要聚焦

         2. 关注服务拆分的粒度，先粗略拆分，再逐渐细化

            > 可以先粗，根据业务的理解程度再做细化

         3. 拆分的过程，要尽量避免影响产品的日常功能迭代

            > 边往前走边往后看

            1. 可优先剥离比较独立的边界服务，从非核心的服务出发，减少拆分对现有业务的影响
            2. 两个服务存在依赖关系时，优先拆分被依赖的服务

         4. 服务接口的定义要具备可扩展性

            > 要考虑调用方是否变更，考虑向前兼容性和向后兼容性

      2. 带来的问题及解决思路

         1. 如何知道调用服务的地址——引入服务注册中心实现服务发现

            > 接口调用方需要知道服务部署在哪些机器的哪个端口上，这些信息需要存储在一个分布式一致性的存储中，于是就需要引入服务注册中心。服务注册中心管理的是服务完整的生命周期，包括对于服务存活状态的检测

         2. 由进程内的方法调用转变为跨网络调用服务带来的性能问题——使用合适的RPC框架

         3. 被依赖的服务的性能出现问题，会导致依赖服务的工作线程池中的线程被占满，致使出现连锁反应 ——引入服务治理体系

            > 针对出问题的服务，采用熔断、降级、限流、超时控制的方法，使得问题被限制在单一服务中，保护服务网络中的其它服务不受影响。

         4. 一条请求的调用链路上，涉及多个服务，调用链路复杂，问题定位较为困难

            > 引入分布式追踪工具，以及更细致的服务端监控报表
            >
            > 监控报表关注的是，依赖服务和资源的宏观性能表现；分布式追踪关注的是，单一慢请求中的性能瓶颈分析，两者需要结合起来帮助你来排查问题

   4. 后微服务

      1. [服务网格Service Mesh](./ServiceMesh.md)

4. 架构设计的定律

   1. 康威定律

      设计系统的组织，其产生的设计等同于组织间的沟通结构。通俗一点说，就是你的团队组织结构是什么样的，你的架构就会长成什么样


## 思考

1. 架构的演进，是为了成本的降低  
   虽然从目前看，逐步演进的架构，会让架构的复杂度变高。但长远看，他的综合成本是会比演进前更低的。  
   成本这个事情不只是强调人强调钱，他应该是综合的，也需要考虑项目生命周期发展的。  
   不过技术架构并不是什么越高级越好，例如对于一个两三人的小团队，维护一个用户量不上万的系统，这种情况就没有上微服务的必要，微服务带来的优势可能都没享受到，带来的复杂度倒是让开发节奏整体变慢了，得不偿失。  
   所以，架构的选择是需要评估的，适合现有团队，适合现有业务，现有成本包得住的，才是当下的好架构.

2. 架构的演进，可能会牺牲一定的业务一定的性能
   单体的服务调用可能都是进程内的调用，SOA/微服务下的调用还需要考虑网络等不稳定的因素，复杂度变高之外，调用的链路其实也变长了。
   单一数据库能较好实现强事务，分布式下即便有各个分布式一致性协议的各种实现保证，但感觉应用的大方向还是在往软事务方向发展。  
   这可能还是个取舍问题，但肯定也是个考虑业务及技术后的最优解的问题

3. 无论哪种系统架构，都强烈建议做工程拆分

   工程拆分其实也能更好的梳理业务边界，完成业务模块的内聚，减少后期维护的成本。

   工程拆分后对未来上微服务架构等也更有优势。

4. 微服务与DevOps的联动

   DevOps在我看来跟微服务其实不大沾边，因为单体服务一样可以推行DevOps。不过后来的感受是，如果微服务下不落地DevOps，会是一个比较痛苦的过程。因为微服务会带来较大的复杂度，尤其是服务拆分后。如果不使用DevOps工具，不基于DevOps的理念，这些复杂度会成为项目演进较大的障碍。

   所以为啥现在大多数讲架构讲微服务的都会把DevOps和微服务连一块儿，我觉得比较大的原因就是DevOps能有助于微服务更好的落地及迭代。还是那句话，成本，以及最优解。

## 参考资料

* 极客时间-高并发系统设计 40 问 
